<!DOCTYPE html>
<html>

<head>
	<script src="jquery-3.4.1.slim.min.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<script type="text/javascript" src="./app.js"></script>
</head>

<body>

	<header>
		<div class="menu">
			<nav>
				<ul>
					<li><button id="showGameButton" class="btn" onclick="showGame()">Game</button> </li>
					<li><button id="showLoginButton" class="btn" onclick="showLogin()">Login</button></li>
					<li><button id="showLogoutButton" class="btn hidden" onclick="logOut()">Log out</button></li>
					<li><button id="showRegisterButton" class="btn" onclick="showRegister()">Register</button></li>
					<li><button id="showAboutButton" class="btn" onclick="showAbout()">About</button></li>
				</ul>
			</nav>
		</div>
	</header>

	<h3 id="welcome" style="text-align: center;">
		Hello and welcome to pacman website.<br />
		Please login or Register !
	</h3>

	<div id="register" class="hidden">
		<table class="flex-center flex-column">
			<tr>
				<th> <label for="username"><b>Username:</b></label> </th>
				<th> <input type="text" placeholder="username" id="registerUsername"> </th>
			</tr>
			<tr>
				<th> <label for="password"><b>Password:</b></label> </th>
				<th> <input type="password" placeholder="password" id="registerPassword"> </th>
			</tr>
			<tr>
				<th> <label for="name"><b>Full Name:</b></label> </th>
				<th> <input type="text" placeholder="name" id="registerName"> </th>
			</tr>
			<tr>
				<th> <label for="email"><b>Email:</b></label> </th>
				<th> <input type="text" placeholder="email" id="registerEmail"> </th>
			</tr>
			<tr>
				<th> <label for="birthday">Birthday:</label> </th>
				<th> <input type="date" id="registerBirthday"> </th>
			</tr>
			<tr>
				<th><button onclick="registerUser()">Register</button></th>
			</tr>
		</table>
	</div>
	<div id="login" class="hidden">
		<table class="flex-center flex-column">
			<tr>
				<th> <label for="username"><b>Username:</b></label> </th>
				<th> <input type="text" placeholder="username" id="loginUsername" required> </th>
			</tr>
			<tr>
				<th> <label for="password"><b>Password:</b></label> </th>
				<th> <input type="password" placeholder="password" id="loginPassword" required> </th>
			</tr>
			<tr>
				<th><button onclick="verifyInformation()">Login</button></th>
			</tr>
		</table>
	</div>

	<div id="aboutModal" class="modal">
		<div class="modal-content">
			<span class="close-btn">&times;</span>
			<p>this is the text inside the modal<br />
				I write here more things<br />
				Few more lines
			</p>
		</div>
	</div>

	<div id="gamePage" style="text-align: center;" class="hidden ">
		<div id="score">
			<label for="lblScore">SCORE:</label>
			<input id="lblScore" type="text" />
		</div>
		<div id="time">
			<label for="lblTime">TIME:</label>
			<input id="lblTime" type="text" />
		</div>
		<div id="game">
			<canvas id="canvas" width="640" height="440"></canvas>
		</div>
	</div>

	<script>//modal's script to open and close
		let modalBtn = document.getElementById("showAboutButton")
		let modal = document.querySelector(".modal")
		let closeBtn = document.querySelector(".close-btn")
		modalBtn.onclick = function () {
			modal.style.display = "block"
		}
		closeBtn.onclick = function () {
			modal.style.display = "none"
		}
		window.onclick = function (e) {
			if (e.target == modal) {
				modal.style.display = "none"
			}
		}
		window.addEventListener('keydown', function (event) {
			if (event.key === 'Escape') {
				modal.style.display = 'none'
			}
		})
	</script>


	<script>//scripts to login/register and navigate
		window.alert("Good");
		let loggedIn = true;
		const users = [];
		let firstUser = {
			username: "p",
			password: "p",
			name: "p p",
			email: "p@p.p",
			birthday: Date.now()
		};
		users.push(firstUser);

		function verifyInformation() {//for login
			//window.alert("Your username is: " + document.getElementById("loginUsername").value + " and your password is: " + document.getElementById("loginPassword").value);

			givenUsername = document.getElementById("loginUsername").value;
			givenPassword = document.getElementById("loginPassword").value;
			let i;
			for (i = 0; i < users.length; i++) {
				if (users[i].username == givenUsername && users[i].password == givenPassword) {
					window.alert("You have successfully log in to the website !");
					loggedIn = true;
					document.getElementById("showLogoutButton").style.display = "block";
					document.getElementById("showLoginButton").style.display = "none";
					document.getElementById("showRegisterButton").style.display = "none";
					showGame();
					return;
				}
				if (i == users.length - 1) {//we arrived to the end
					window.alert("There is a problem with the username or the password");
				}
			}
		}

		function registerUser() {//register user
			//check that everything is ok:
			//check if all fields been submited
			/*if ($("#register input:empty").length != 0) {
				window.alert("You need to fill everything first\n" + "number of empty fields is: " + $("#register input:empty").length);
				return;
			}*/
			if ($('#registerUsername').val().length == 0 || $('#registerPassword').val().length == 0 || $('#registerName').val().length == 0 || $('#registerEmail').val().length == 0 || $('#registerBirthday').val() == 0) {
				window.alert("You need to fill all fields in order to continue");
				return;
			}

			if ($('#registerPassword').val() < 6) {
				window.alert("Password need to be at least 6 characters long")
				return;
			}
			if (!containsLetterAndNumber($('#registerPassword').val())) {
				window.alert("Password need to be alphanumeric and need to contains at least one letter and at least one number");
				return;
			}
			if (doesContainsNumber($('#registerName').val())) {
				window.alert("Name can't have numbers in it");
				return;
			}
			if (!validateEmail($('#registerEmail').val())) {
				window.alert("Email is not valid");
				return;
			}

			window.alert("good");
			//check if pasword has letters and numbers and is larger then 5
			//check if name doesn't have numbers
			//check if email is legal.
			let newUser = {
				username: document.getElementById("registerUsername").value,
				password: document.getElementById("registerPassword").value,
				name: document.getElementById("registerName").value,
				email: document.getElementById("registerEmail").value,
				birthday: document.getElementById("registerBirthday").value
			};
			//add the user to the users array
			users.push(newUser);
			window.alert("You have successfully Register to the site with username: " + users[users.length - 1].username);
		}

		function validateEmail(email) {
			var re = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
			return re.test(email);
		}

		function containsLetterAndNumber(str) {
			let code, i, len;
			let foundLetter = false;
			let foundNumber = false;
			let foundIllegalCharacter;
			for (i = 0, len = str.length; i < len; i++) {
				code = str.charCodeAt(i);
				if (code > 47 && code < 58) { // numeric (0-9)
					foundNumber = true;
				}
				else if (code > 64 && code < 91) {// upper alpha (A-Z)
					foundLetter = true;
				}
				else if (code > 96 && code < 123) { // lower alpha (a-z)
					foundLetter = true;
				}
				else {
					foundIllegalCharacter = true
				}
			}
			return foundNumber && foundLetter && !foundIllegalCharacter;
		};

		function doesContainsNumber(str) {
			let code, i, len;
			for (i = 0, len = str.length; i < len; i++) {
				code = str.charCodeAt(i);
				if (code > 47 && code < 58) { // numeric (0-9)
					return true;
				}
			}
			return false;
		}

		function showRegister() {
			document.getElementById("register").style.display = "block";
			document.getElementById("login").style.display = "none";
			document.getElementById("welcome").style.display = "none";
			document.getElementById("gamePage").style.display = "none";
		}

		function showLogin() {
			document.getElementById("login").style.display = "block";
			document.getElementById("register").style.display = "none";
			document.getElementById("welcome").style.display = "none";
			document.getElementById("gamePage").style.display = "none";
		}

		function showGame() {
			if (loggedIn) {
				document.getElementById("gamePage").style.display = "block";
				document.getElementById("register").style.display = "none";
				document.getElementById("login").style.display = "none";
				document.getElementById("welcome").style.display = "none";
				Start();
			}
			else {
				window.alert("You can't enter the game if you're not logged in");
			}
		}

		function logOut() {
			loggedIn = false;
			document.getElementById("showLoginButton").style.display = "block";
			document.getElementById("showRegisterButton").style.display = "none";
			document.getElementById("showLogoutButton").style.display = "none";
			document.getElementById("welcome").style.display = "block";
			document.getElementById("gamePage").style.display = "none";
			document.getElementById("register").style.display = "none";
			document.getElementById("login").style.display = "none";
		}
	</script>

</body>

</html>